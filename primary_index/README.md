# mysql 优化

# 浅显易懂 索引的重要性 看效果

```mysql

下表没有任何索引

mysql> show index from er_2020;
Empty set (0.00 sec)

mysql> select    uid,type,status,ctime,dtime     from     er_2020  where uid in (56012821,56012891,56012916,56012928,56012949);
+----------+--------+---------------------+---------------------+
| uid      | status |  ctime              | dtime               |
+----------+--------+---------------------+---------------------+
| 56012821 |      1 | 2020-02-23 21:05:55 | 2020-02-23 22:02:00 |
| 56012891 |      1 | 2020-02-23 22:02:39 | 2020-02-25 09:20:00 |
| 56012916 |      0 | 2020-02-23 20:15:46 | 2020-02-24 10:00:10 |
| 56012928 |      0 | 2020-02-23 21:16:02 | 2020-02-25 12:00:30 |
| 56012949 |      1 | 2020-02-23 23:19:20 | 2020-02-26 20:00:50 |
+----------+--------+---------------------+---------------------+
5 rows in set (6.69 sec)

mysql> update  er_2020   set status=0  where uid in (56012821,56012891,56012916,56012928,56012949);
Query OK, 5 rows affected (22.73 sec)
Rows matched: 5  Changed: 5  Warnings: 0


mysql> select    uid,type,status,ctime,dtime     from     er_2020  where uid = 56012822;
+----------+--------+---------------------+---------------------+
| uid      | status |  ctime              | dtime               |
+----------+--------+---------------------+---------------------+
| 56012822 |      0 | 2020-03-26 21:07:16 | 2020-03-29 20:07:16 |
+----------+--------+---------------------+---------------------+
1 row in set (6.62 sec)

mysql> update  er_2020   set status=1  where uid = 56012822;
Query OK, 1 row affected (22.62 sec)
Rows matched: 1  Changed: 1  Warnings: 0

mysql> select count(uid) from er_2020;
+--------------+
| count(uid)   |
+--------------+
|     91914155 |
+--------------+
1 row in set (0.83 sec)

mysql> select count(uid) from er_2019;
+--------------+
| count(uid)   |
+--------------+
|    314576622 |
+--------------+
1 row in set (15.62 sec)

mysql> select count(uid) from er;
+--------------+
| count(uid)   |
+--------------+
|    651858421 |
+--------------+
1 row in set (0.71 sec)

下表有主键索引

mysql> show index from er;
+--------+------------+-----------+--------------+--------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
| Table  | Non_unique | Key_name  | Seq_in_index | Column_name  | Collation | Cardinality | Sub_part | Packed | Null | Index_type | Comment | Index_comment | Visible | Expression |
+--------+------------+-----------+--------------+--------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
|   er   |          0 | PRIMARY   |            1 | uid          | A         |     4996616 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       |
+--------+------------+-----------+--------------+--------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+


mysql> select    uid,type,status,ctime,dtime     from     er  where uid = 60128221;
+----------+--------+---------------------+---------------------+
| uid      | status |  ctime              | dtime               |
+----------+--------+---------------------+---------------------+
| 60128221 |      1 | 2020-01-26 21:07:16 | 2020-01-29 09:07:16 |
+----------+--------+---------------------+---------------------+
1 row in set (0.00 sec)


mysql> select    uid,type,status,ctime,dtime     from     er  where uid in (56012821,56012891,56012916,56012928,56012949);
+----------+--------+---------------------+---------------------+
| uid      | status |  ctime              | dtime               |
+----------+--------+---------------------+---------------------+
| 56012821 |      1 | 2020-02-23 20:06:25 | 2020-02-26 00:00:00 |
| 56012891 |      1 | 2020-02-23 21:09:29 | 2020-02-25 00:00:00 |
| 56012916 |      0 | 2020-02-23 20:10:36 | 2020-02-27 00:00:00 |
| 56012928 |      0 | 2020-02-23 21:11:22 | 2020-02-24 00:00:00 |
| 56012949 |      1 | 2020-02-23 22:12:40 | 2020-02-27 00:00:00 |
+----------+--------+---------------------+---------------------+
5 rows in set (0.00 sec)




```

